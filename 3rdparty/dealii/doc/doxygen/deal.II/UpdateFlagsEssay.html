<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>The deal.II Library: The interplay of UpdateFlags, Mapping and FiniteElement in FEValues</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="http://www.dealii.org/deal.ico"></link>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2014 by the deal.II authors"></meta>
<meta name="deal.II-version" content="8.1.0"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 8.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The interplay of UpdateFlags, <a class="el" href="classMapping.html">Mapping</a> and <a class="el" href="classFiniteElement.html">FiniteElement</a> in <a class="el" href="classFEValues.html">FEValues</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>In order to compute local contributions of an individual to the global matrix and right hand side, integrals are usually transformed to the reference cell. For example, for the Laplace matrix, on each cell we have to compute </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ A^K_{ij} = \sum_{q}J^{-1}(\hat{\bf x}_q) \hat \nabla \varphi_i(\hat{\bf x}_q) \cdot J^{-1}(\hat{\bf x}_q) \hat \nabla \varphi_j(\hat{\bf x}_q)\ |\textrm{det}\ J(\hat{\bf x}_q)| w_q, \]" src="form_140.png"/>
</p>
<p> where a hat indicates reference coordinates, and <img class="formulaInl" alt="$J(\hat{\bf x}_q)$" src="form_141.png"/> is the Jacobian <img class="formulaInl" alt="$\frac{\partial F_K(\hat{\bf x}_q)}{\partial\bf \hat x}$" src="form_142.png"/> of the mapping, evaluated at a quadrature point <img class="formulaInl" alt="$\hat{\bf x}_q$" src="form_143.png"/> on the reference cell.</p>
<p>In order to evaluate such an expression in an application code, we have to access three different kinds of objects: a quadrature object that describes locations <img class="formulaInl" alt="$\hat{\bf x}_q$" src="form_143.png"/> and weights <img class="formulaInl" alt="$w_q$" src="form_144.png"/> of quadrature points on the reference cell; a finite element object that describes the gradients <img class="formulaInl" alt="$\hat\nabla \varphi_i(\hat{\bf x}_q)$" src="form_145.png"/> of shape functions on the unit cell; and a mapping object that provides the Jacobian as well as its determinant. Dealing with all these objects would be cumbersome and error prone.</p>
<p>On the other hand, these three kinds of objects almost always appear together, and it is in fact very rare for deal.II application codes to do anything with quadrature, finite element, or mapping objects besides using them together. For this reason, we have introduced the <a class="el" href="classFEValues.html">FEValues</a> abstraction combining information on the shape functions, the geometry of the actual mesh cell and a quadrature rule on a reference cell. Upon construction it takes one object of each of the three mentioned categories. Later, it can be "re-initialized" for a concrete grid cell and then provides mapped quadrature points and weights, mapped shape function values and derivatives as well as some properties of the transformation from the reference cell to the actual mesh cell.</p>
<p>Since computation of any of these values is potentially expensive (for example when using high order mappings with high order elements), the <a class="el" href="classFEValues.html">FEValues</a> class only computes what is explicitly asked for. To this end, it takes a list of flags of type UpdateFlags at construction time specifying which quantities should be updated each time a cell is visited. In addition, allowing further optimizations, the functions filling the data fields of <a class="el" href="classFEValues.html">FEValues</a> are able to distinguish between values that have to be recomputed on each cell (for example mapped gradients) and quantities that do not change from cell to cell (for example the values of shape functions of the usual <img class="formulaInl" alt="$Q_k$" src="form_146.png"/> finite elements at the same quadrature points on different cells; this property does not hold for the shape functions of Raviart-Thomas elements, however, which must be rotated with the local cell).</p>
<p>At construction time, each <a class="el" href="classFEValues.html">FEValues</a> object splits the given UpdateFlags into two sets: those flags that describe quantities that can be computed on the reference cell once at the beginning ("update_once"), and those that require recomputation on each cell ("update_each").</p>
<p>Furthermore, each <a class="el" href="classFEValues.html">FEValues</a> object is associated with a <a class="el" href="classMapping.html">Mapping</a> and a <a class="el" href="classFiniteElement.html">FiniteElement</a> object that do the actual computations. It therefore keeps a set up UpdateFlags for both update_once and update_each operations for both the <a class="el" href="classMapping.html">Mapping</a> and the <a class="el" href="classFiniteElement.html">FiniteElement</a> object it is associated with.</p>
<h2>Update once or each</h2>
<p>Sometimes in order to compute one quantity, something else also has to be computed. For example, if only update_values is requested by the user of a <a class="el" href="classFEValues.html">FEValues</a> object and if the associated finite element is of type <a class="el" href="classFE__Q.html">FE_Q</a>, then <code>update_once=update_values</code> and <code>update_each=0</code> for the <a class="el" href="classFiniteElement.html">FiniteElement</a> computations and <code>update_once=update_each=0</code> for the <a class="el" href="classMapping.html">Mapping</a> object: we can compute the values of the shape function at the quadrature points of each cell once on the reference cell, and they will have the same value at the quadrature point of a real cell. There is nothing the finite element object has to do when we move to the next cell (these would be update_each calculations) and there is nothing the mapping has to do, either up front (update_once) or on each cell (update_each).</p>
<p>However, this is not the case if we used a <a class="el" href="classFE__RaviartThomas.html">FE_RaviartThomas</a> element: there, computing the values of the shape functions on a cell involves knowing the Jacobian of the mapping, and so if a user requests <code>update_values</code> of a <a class="el" href="classFEValues.html">FEValues</a> object that uses a <a class="el" href="classFE__RaviartThomas.html">FE_RaviartThomas</a> element, then we can set <code>update_once=update_values</code> and <code>update_each=0</code> for the <a class="el" href="classFiniteElement.html">FiniteElement</a>, but need to set <code>update_once=0</code> <code>update_each=update_jacobians</code> for the <a class="el" href="classMapping.html">Mapping</a> object.</p>
<p>To accommodate this structure, at the time a <a class="el" href="classFEValues.html">FEValues</a> object is constructed, it asks both the <a class="el" href="classFiniteElement.html">FiniteElement</a> and the <a class="el" href="classMapping.html">Mapping</a> object it uses the following: </p>
<ol>
<li>
Are any additional values required in order to compute the currently required values? If so, add these flags to the current set. Another example to the one above would be that the derivative of a standard scalar element requires the inverse of the Jacobian of the <a class="el" href="classMapping.html">Mapping</a>. </li>
<li>
Given the enhanced set, determine the subsets of values that is performed on the reference cell only and on each cell, respectively. </li>
</ol>
<p>In order to compute this, there are functions <a class="el" href="classMapping.html#ad763fd4b4286d869c5f89f6cd4fa142f">Mapping::update_once()</a> and <a class="el" href="classMapping.html#a3d5b93361958038a33586a23be3c532d">Mapping::update_each()</a> as well as <a class="el" href="classFiniteElement.html#a53ec2e9b0b29a6c0df0b941528be0306">FiniteElement::update_once()</a> and <a class="el" href="classFiniteElement.html#a876f0be1b38ad6ed2ccad297876e1287">FiniteElement::update_each()</a>. All of them accept UpdateFlags as the set of desired flags and return UpdateFlags as the set of required flags on the reference and on each cell, respectively. Additionally, <a class="el" href="classFiniteElement.html#a53ec2e9b0b29a6c0df0b941528be0306">FiniteElement::update_once()</a> should set all flags for values that are required from the <a class="el" href="classMapping.html">Mapping</a>. The function in <a class="el" href="classFEValues.html">FEValues</a> computing the actual set of flags from the desired one looks like this: <code> flags |= fe-&gt;update_once (flags) | fe-&gt;update_each (flags); flags |= mapping-&gt;update_once (flags) | mapping-&gt;update_each (flags); </code> That is, a <a class="el" href="classFiniteElement.html">FiniteElement</a> can set additional flags which are honored by the <a class="el" href="classMapping.html">Mapping</a>.</p>
<h2>Generation of the actual data</h2>
<p>As outlined above, data is computed at two different times: once at the beginning on the reference cell, and once whenever we move to an actual cell. The functions involved in each of these steps are discussed next:</p>
<h3>Initialization</h3>
<p>Computing data on the reference cell before we even visit the first real cell is a two-step process. First, the constructor of <a class="el" href="classFEValues.html">FEValues</a>, <a class="el" href="classFEFaceValues.html">FEFaceValues</a> and <a class="el" href="classFESubfaceValues.html">FESubfaceValues</a>, respectively, need to allow the <a class="el" href="classMapping.html">Mapping</a> and <a class="el" href="classFiniteElement.html">FiniteElement</a> objects to set up internal data structures. These structures are internal in the following sense: the <a class="el" href="classFEValues.html">FEValues</a> object asks the finite element and mapping objects to create an object of type <a class="el" href="classFiniteElement_1_1InternalDataBase.html">FiniteElement::InternalDataBase</a> and <a class="el" href="classMapping_1_1InternalDataBase.html">Mapping::InternalDataBase</a> each; the actual finite element and mapping class may in fact create objects of a derived type if they wish to store some data beyond what these base classes already provide. The functions involved in this are </p>
<ul>
<li>
<a class="el" href="classMapping.html#ad9ca84775e1e274dead112d51fee84cd">Mapping::get_data()</a> </li>
<li>
<a class="el" href="classMapping.html#a04a09a85f1554d576bb92c2b9f1b849c">Mapping::get_face_data()</a> </li>
<li>
<a class="el" href="classMapping.html#ad4a55272558fa41560488112d16e2945">Mapping::get_subface_data()</a> </li>
<li>
<a class="el" href="classFiniteElement.html#aada317cd0cdd78de8f747bc458655218">FiniteElement::get_data()</a> </li>
<li>
<a class="el" href="classFiniteElement.html#a998bb8e8b7ee2a035d039cc558f47898">FiniteElement::get_face_data()</a> </li>
<li>
<a class="el" href="classFiniteElement.html#ae3da3d8441ecd90b4f0ffbb656811245">FiniteElement::get_subface_data()</a> </li>
</ul>
<p>The <a class="el" href="classFEValues.html">FEValues</a> object then takes over ownership of these objects and will destroy them at the end of the <a class="el" href="classFEValues.html">FEValues</a> object's lifetime. After this, the <a class="el" href="classFEValues.html">FEValues</a> object asks the <a class="el" href="classFiniteElement.html">FiniteElement</a> and <a class="el" href="classMapping.html">Mapping</a> objects to fill these InternalDataBase objects with the data that pertains to what can and needs to be computed on the reference cell. This is done in these functions: </p>
<ul>
<li>
<a class="el" href="classFEValues.html#a887641164e5e42d1c2300e552b6edcbd">FEValues::initialize()</a> </li>
<li>
<a class="el" href="classFEFaceValues.html#a70bced686973a3a18b542e32384e3d19">FEFaceValues::initialize()</a> </li>
<li>
<a class="el" href="classFESubfaceValues.html#a3e75580dbd7113935c5e55dcd9510f95">FESubfaceValues::initialize()</a> </li>
</ul>
<h3>Reinitialization for a mesh cell</h3>
<p>Once initialization is over and we call <a class="el" href="classFEValues.html#afde502903642c57ade24dfcebf5c1650">FEValues::reinit</a>, <a class="el" href="classFEFaceValues.html#a4952ecc276a0f22d48d17d197ffda940">FEFaceValues::reinit</a> or <a class="el" href="classFESubfaceValues.html#a5ad7b790a1d6f603368cf1e8a7b5f786">FESubfaceValues::reinit</a> to move to a concrete cell or face, we need to calculate the update_each kinds of data. This done in the following functions: </p>
<ul>
<li>
<a class="el" href="classFEValues.html#afde502903642c57ade24dfcebf5c1650">FEValues::reinit()</a> calls <a class="el" href="classMapping.html#a78292128320b8232676365215bb68688">Mapping::fill_fe_values()</a>, then <a class="el" href="classFiniteElement.html#a6f982cbcd77e6067fb61c8ec4573091a">FiniteElement::fill_fe_values()</a> </li>
<li>
<a class="el" href="classFEFaceValues.html#a4952ecc276a0f22d48d17d197ffda940">FEFaceValues::reinit()</a> calls <a class="el" href="classMapping.html#aa1dce733dce6d173827154a9a72a7fc8">Mapping::fill_fe_face_values()</a>, then <a class="el" href="classFiniteElement.html#ab19a60429e5405beb8447a1a7d51765c">FiniteElement::fill_fe_face_values()</a> </li>
<li>
<a class="el" href="classFESubfaceValues.html#a5ad7b790a1d6f603368cf1e8a7b5f786">FESubfaceValues::reinit()</a> calls <a class="el" href="classMapping.html#ad22d35be7eceb8d42901d11cd6e55e57">Mapping::fill_fe_subface_values()</a>, thenFiniteElement::fill_fe_subface_values() </li>
</ul>
<p>This is, where the actual data fields for <a class="el" href="classFEValues.html">FEValues</a>, stored in <a class="el" href="classFEValuesData.html">FEValuesData</a> objects is computed. These functions call the function in <a class="el" href="classMapping.html">Mapping</a> first, such that all the mapping data required by the finite element is available. Then, the <a class="el" href="classFiniteElement.html">FiniteElement</a> function is called.</p>
<p>When this happens for the first time after initialization, all the values specified by <a class="el" href="classMapping_1_1InternalDataBase.html#aff6273622264ae4410d280e0ce7d4ab2">Mapping::InternalDataBase::update_once</a> or <a class="el" href="classMapping_1_1InternalDataBase.html#a43f4579d65a86db27d208ebf42ad3f44">Mapping::InternalDataBase::update_each</a> are filled. After that, only the values specified by <a class="el" href="classMapping_1_1InternalDataBase.html#a43f4579d65a86db27d208ebf42ad3f44">Mapping::InternalDataBase::update_each</a> will be updated. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 27 2014 15:26:05 for The deal.II Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
