build:
  tags:
    - linux
  script: 
    - git submodule update --init 
    - cd dealii 
    - mkdir -p build 
    - cd build 
    - cmake ..
    - make -j12 
    - cd ../../
    # - export CC=/usr/bin/clang
    # - export CXX=/usr/bin/clang++     
    - cmake . 
    - make -j12
    - ./agros2d_generator
    - cd plugins
    - cmake .
    - make -j12
    # appimage 
    - cd ..
    - strip libs/*.so
    - strip agros2d
    - strip agros2d_solver
    - strip pythonlab
    - ./tools.py appimage
    - mkdir -p ~/appimage/$CI_BUILD_REF
    - cp Agros-x86_64.AppImage ~/appimage/$CI_BUILD_REF 
    - curl -T Agros-x86_64.AppImage --ftp-create-dirs ftp://agros2d.org-www-version-builds:H7sda0@agros2d.org/$CI_BUILD_REF/Agros-x86_64.AppImage
    # test
    - cd resources/python
    - cmake .
    - ctest -D Experimental
    
build_mumps:
  tags:
    - linux
  script: 
    - export CC=/usr/bin/clang
    - export CXX=/usr/bin/clang++    
    - cd solver-external-mumps
    - cmake .
    - make 
    - ctest --output-on-failure -D Experimental
    
build_umfpack:
  tags:
    - linux
  script: 
    - export CC=/usr/bin/clang
    - export CXX=/usr/bin/clang++    
    - cd solver-external-umfpack
    - cmake .
    - make 
    - ctest --output-on-failure -D Experimental
    
build_paralution:
  tags:
    - linux
  script: 
    - cd solver-external-paralution
    - cd paralution
    - mkdir -p build 
    - cd build 
    - cmake ..
    - make -j12    
    - cd ../../
    - cmake .
    - make 
    - ctest -V -D Experimental
    
build_trilinos:
  tags:
    - linux
  script: 
    - export CC=/usr/bin/clang
    - export CXX=/usr/bin/clang++    
    - cd solver-external-trilinos
    - cmake .
    - make 
    - ctest --output-on-failure -D Experimental
    
build_petsc:
  tags:
    - linux
  script:    
    - cd solver-external-petsc
    - cmake .
    - make 
    - ctest --output-on-failure -D Experimental
