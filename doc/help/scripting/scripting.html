<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<link rel="stylesheet" type="text/css" href="../style.css" media="screen" title="Default">
	<title>Scripting</title>
</head>
<body>
<h1>Scripting</h1>

<p>Scripting in Agros2D is based on <a href="http://doc.trolltech.com/4.3/qtscript.html">QtScript</a> (ECMAScript Programming Language).</p>

<div id="content">
	<h3>Contents</h3>
	<ul>
		<li><a href="#syntax">Syntax</a></li>
		<li><a href="#general_commands">General Commands</a></li>
		<li><a href="#document_commands">Document Commands</a></li>
		<li><a href="#geometry_commands">Geometry Commands</a></li>
		<li><a href="#materials_and_boundaries_commands">Materials and Boundaries Commands</a></li>
		<li><a href="#postprocessor_commands">Postprocessor Commands</a></li>
		<li><a href="#predefined_user_functions">Predefined User Functions</a></li>
		<li><a href="#examples">Examples</a></li>
		<li><a href="#tips">Tips</a></li>
		<li><a href="#links">Links</a></li>
	</ul>
</div>

<a id="syntax"></a><h2>Syntax</h2>

<a id="general_commands"></a><h2>General Commands</h2>
<h3>version()</h3>
<p>Print Agros2D version.</p>

<h3>quit()</h3>
<p>Quit Agros2D.</p>

<h3>include(filename)</h3>
<p>Include and run script with filename.</p>
<pre class="code">
pathToScript = "data/scripts/";
include(pathToScript +"electrostatic_axisymmetric_capacitor.qs");
</pre>

<h3>solve()</h3>
<p>Solve problem.</p>

<h3>print(string)</h3>
<p>Print string to console.</p>

<h3>printToFile(filename, string, mode = {"write", "append"})</h3>
<p>Print string to file.</p>
<pre class="code">
printToFile("version.txt", "Agros2D version:", "write");
printToFile("version.txt", version(), "append");
</pre>

<h3>variable = input(string)</h3>
<p>Show input box.</p>

<h3>message(string)</h3>
<p>Show message box.</p>

<h3>zoomBestFit()</h3>
<p>Zoom best fit.</p>

<h3>zoomIn()</h3>
<p>Zoom in.</p>

<h3>zoomOut()</h3>
<p>Zoom out.</p>

<h3>zoomRegion(x1, y1, x2, y2)</h3>
<p>Zoom region from [x1, y1] to [x2, y2].</p>

<a id="document_commands"></a><h2>Document Commands</h2>
<h3>newDocument(name, type, physicfield, numberofrefinements, polynomialorder, frequency, adaptivitytype, adaptivitysteps, adaptivitytolerance)</h3>
<p>Create new document.</p>
<ul>
	<li>
		<p>type = {"planar", "axisymmetric"}</p>
	</li>
	<li>
		<p>numberofrefinements >= 0</p>
	</li>
	<li>
		<p>polynomialorder = 1 to 10</p>
	</li>
	<li>
		<p>physicfield = {"electrostatic", "magnetostatic", "current field", "heat transfer", "harmonic magnetic"}</p>
	</li>
	<li>
		<p>adaptivitytype = {"disabled", "h-adaptivity", "p-adaptivity", "hp-adaptivity"}</p>
	</li>
	<li>
		<p>frequency >= 0 (only for harmonic magnetic field)</p>
	</li>
	<li>
		<p>adaptivitysteps > 0</p>
	</li>
	<li>
		<p>adaptivitytolerance > 0</p>
	</li>
</ul>
<pre class="code">
newDocument("Electrostatic axisymmetric capacitor", "axisymmetric", "electrostatic", 1, 2, 0, "hp-adaptivity", 10, 1);
</pre>

<h3>openDocument(filename)</h3>
<p>Open document.</p>

<h3>saveDocument(filename)</h3>
<p>Save document.</p>

<h3>mode(mode = {"node", "edge", "label", "postprocessor"})</h3>
<p>Set mode.</p>

<a id="geometry_commands"></a><h2>Geometry Commands</h2>
<h3>addNode(x, y)</h3>
<p>Add new node with coordinates [x, y].</p>

<h3>addEdge(x1, y1, x2, y2, angle, marker)</h3>
<p>Add new edge with from coordinates [x1, y1] to [x2, y2], angle and marker.</p>

<h3>addLabel(x, y, area, marker)</h3>
<p>Add new label with coordinates [x, y], area of triangle and marker.</p>

<h3>selectNone()</h3>
<p>Unselect objects.</p>

<h3>selectAll()</h3>
<p>Select all objects.</p>

<h3>selectNode(index, ...)</h3>
<p>Select nodes with given index.</p>

<h3>selectEdge(index, ...)</h3>
<p>Select edges with given index.</p>

<h3>selectLabel(index, ...)</h3>
<p>Select labels with given index.</p>

<h3>selectNodePoint(x, y)</h3>
<p>Select the closest node with coordinates [x, y].</p>

<h3>selectEdgePoint(x, y)</h3>
<p>Select the closest edge with coordinates [x, y].</p>

<h3>selectLabelPoint(x, y)</h3>
<p>Select the closest label with coordinates [x, y].</p>

<h3>deleteSelection()</h3>
<p>Delete selected objects.</p>

<h3>moveSelection(dx, dy, copy = false)</h3>
<p>Move selected objects.</p>

<h3>rotateSelection(x, y, angle, copy = false)</h3>
<p>Rotate selected objects.</p>

<h3>scaleSelection(x, y, scale, copy = false)</h3>
<p>Scale selected objects.</p>

<a id="materials_and_boundaries_commands"></a><h2>Materials and Boundaries Commands</h2>
<h3>addBoundary(name, type, value, ...)</h3>
<p>Add boundary marker.</p>
<ul>
	<li>
		<h4>Electrostatic field</h4>
		<p>addBoundary(name, type = {"potential", "surface_charge_density"}, value)</p>
	</li>
	<li>
		<h4>Electric current field</h4>
		<p>addBoundary(name, type = {"potential", "inward_current_flow"}, value)</p>
	</li>
	<li>
		<h4>Magnetostatic field</h4>
		<p>addBoundary(name, type = {"vector_potential", "surface_current_density"}, value)</p>
	</li>
	<li>
		<h4>Harmonic magnetic field</h4>
		<p>addBoundary(name, type = {"vector_potential", "surface_current_density"}, value)</p>
	</li>
	<li>
		<h4>Heat transfer</h4>
		<p>addBoundary(name, type = "temperature", temperature)</p>
		<p>addBoundary(name, type = "heat_flux", heat_flux, h, external_temperature)</p>
	</li>
</ul>

<h3>addMaterial(name, type, value, ...)</h3>
<p>Add label marker.</p>
<ul>
	<li>
		<h4>Electrostatic field</h4>
		<p>addMaterial(name, charge_density, permittivity)</p>
	</li>
	<li>
		<h4>Electric current field</h4>
		<p>addMaterial(name, conductivity)</p>
	</li>
	<li>
		<h4>Magnetostatic field</h4>
		<p>addMaterial(name, current_density, double permeability)</p>
	</li>
	<li>
		<h4>Harmonic magnetic field</h4>
		<p>addMaterial(name, current_density_real, current_density_imag, double permeability, conductivity)</p>
	</li>
	<li>
		<h4>Heat transfer</h4>
		<p>addMaterial(name, volume_heat, thermal_conductivity)</p>
	</li>
</ul>

<a id="postprocessor_commands"></a><h2>Postprocessor Commands</h2>
<h3>result = pointResult(x, y)</h3>
<p>Local variables at point [x, y].</p>
<ul>
	<li>
		<h4>Electrostatic field</h4>
		<p>Properties: X, Y, V, Ex, Ey, E, Dx, Dy, wj, epsr.</p>
	</li>
	<li>
		<h4>Magnetostatic field</h4>
		<p>Properties: X, Y, A, Bx, By, B, Hx, Hy, H, wm, mur.</p>
	</li>
	<li>
		<h4>Electric current field</h4>
		<p>Properties: X, Y, V, Jx, Jy, J, Ex, Ey, E, pj, gamma.</p>
	</li>
	<li>
		<h4>Harmonic magnetic field</h4>
		<p>Properties: X, Y, A_real, A_imag, A, B, Bx_real, By_real, B_real, Bx_imag, By_imag, B_imag, H, Hx_real, Hy_real, H_real, Hx_imag, Hy_imag, H_imag, Ji_real, Ji_imag, Ji_real, J_real, J_imag, J_real, pj, wm, mur</p>
	</li>
	<li>
		<h4>Heat transfer</h4>
		<p>Properties: X, Y, T, Gx, Gy, G, Fx, Fy, F, lambda.</p>
	</li>
</ul>
<pre class="code">
result = pointResult(0.1, 0.1);
print("Potential = " + result.V);
</pre>

<h3>integral = volumeIntegral(index, ...)</h3>
<p>Volume integral in areas with given index.</p>
<ul>
	<li>
		<h4>Electrostatic field</h4>
		<p>Properties: V, S, Ex_avg, Ey_avg, E_avg, Dx_avg, Dy_avg, D_avg, We.</p>
	</li>
	<li>
		<h4>Magnetostatic field</h4>
		<p>Properties: V, S, Bx_avg, By_avg, B_avg, Hx_avg, Hy_avg, H_avg, Wm.</p>
	</li>
	<li>
		<h4>Electric current field</h4>
		<p>Properties: V, S, Jx_avg, Jy_avg, J_avg, Ex_avg, Ey_avg, E_avg, Pj.</p>
	</li>
	<li>
		<h4>Harmonic magnetic field</h4>
		<p>Properties: V, S, Ii_real, Ii_imag, It_real, It_imag, Pj, Fx_real, Fx_imag, Fy_real, Fy_imag, Wm.</p>
	</li>
	<li>
		<h4>Heat transfer</h4>
		<p>Properties: V, S, T, Gx_avg, Gy_avg, G_avg, Fx_avg, Fy_avg, F_avg.</p>
	</li>
</ul>
<pre class="code">
integral = volumeIntegral(0.1, 0.1);
print("Volume = " + integral.V);
</pre>

<h3>integral = surfaceIntegral(index, ...)</h3>
<p>Surface integral in edges with given index.</p>
<ul>
	<li>
		<h4>Electrostatic field</h4>
		<p>Properties: l, S, Q.</p>
	</li>
	<li>
		<h4>Electric current field</h4>
		<p>Properties: l, S, I.</p>
	</li>
	<li>
		<h4>Magnetostatic field</h4>
		<p>Properties: l, S.</p>
	</li>
	<li>
		<h4>Harmonic magnetic field</h4>
		<p>Properties: l, S.</p>
	</li>
	<li>
		<h4>Heat transfer</h4>
		<p>Properties: l, S, T_avg, T_diff, F.</p>
	</li>
</ul>
<pre class="code">
integral = surfaceIntegral(0.1, 0.1);
print("Charge = " + integral.Q);
</pre>

<a id="predefined_user_functions"></a><h2>Predefined User Functions</h2>

<a id="examples"></a><h2>Examples</h2>
<h3>Electrostatic axisymmetric capacitor</h3>
<pre class="code">
// model
newDocument("Electrostatic axisymmetric capacitor", "axisymmetric", "electrostatic", 1, 2, 0, "hp-adaptivity", 10, 1);

// variables
r1 = 0.01;
r2 = 0.03;
r3 = 0.05;
r4 = 0.06;
l = 0.16;
eps1 = 10;
eps2 = 3;
U = 10;
dr = 0.01;

// boundaries
addBoundary("Source electrode", "potential", U);
addBoundary("Ground electrode", "potential", 0);
addBoundary("Neumann BC", "surface_charge_density", 0);

// materials
addMaterial("Air", 0, 1);
addMaterial("Dielectric n.1", 0, eps1);
addMaterial("Dielectric n.2", 0, eps2);

// edges
addEdge(0, 3/2*l, 0, l/2, 0, "Neumann BC");
addEdge(r1, l/2, r1, 0, 0, "Source electrode");
addEdge(r1, 0, r2, 0, 0, "Neumann BC");
addEdge(r2, 0, r2, l/2, 0, "none");
addEdge(r2, l/2, r3, l/2, 0, "none");
addEdge(r3, 0, r2, 0, 0, "Neumann BC");
addEdge(r3, l/2, r3, 0, 0, "Ground electrode");
addEdge(r4, 0, r4, l/2, 0, "Ground electrode");
addEdge(r3, l/2, r4, l/2, 0, "Ground electrode");
addEdge(r4, 0, 3/2*l, 0, 0, "Neumann BC");
addEdge(3/2*l, 0, 0, 3/2*l, 90, "Neumann BC");
addEdge(r1, l/2, r2, l/2, 0, "none");
addEdge(r1, l/2, 0, l/2, 0, "Source electrode");

// labels
addLabel(0.019, 0.021, 0, "Dielectric n.1");
addLabel(0.0379, 0.051, 0, "Dielectric n.2");
addLabel(0.0284191, 0.123601, 0, "Air");

zoomBestFit();
selectNone();

// calculation of capacity
print("C = f(r) (F):");
i = 0;
do
{
	if (i > 0)
	{
		selectEdge(6, 7, 8);
		moveSelection(dr, 0);
	}
	solve();
	integral = volumeIntegral();

	print((2*2*integral.We)/(U^2));
	i++;
} while (i<5);
</pre>

<a id="tips"></a><h2>Tips</h2>
<p>You can run single commands and user functions. Select "Run command..." in the menu "Tools", or by pressing &lt;Alt&gt;+C and enter command, or user function.</p>

<a id="links"></a><h2>Links</h2>
<ul>
	<li><a href="http://doc.trolltech.com/4.3/qtscript.html">QtScript Module</a></li>
	<li><a href="http://www.ecmascript.org">ECMAScript Programming Language</a></li>
</ul>
</body>
</html>
