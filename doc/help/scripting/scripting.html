<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="../style.css" media="screen" title="Default">
  <title>Scripting</title>
</head>
<body>
<h1>Scripting</h1>
<p>QtScript is based on the ECMAScript scripting language.</p>

<h2>Reference documentation</h2>
<h3>newDocument(name, type, physicfield, numberofrefinements, polynomialorder, adaptivitysteps, adaptivitytolerance)</h3>
<p>Create new document.</p>

<h3>openDocument(filename)</h3>
<p>Open document.</p>

<h3>saveDocument(filename)</h3>
<p>Save document.</p>

<h3>addNode(x, y)</h3>

<h3>addLabel(x, y, area, marker)</h3>

<h3>addEdge(x1, y1, x2, y2, angle, marker)</h3>

<h3>addBoundary(name, type, value, ...)</h3>
<p>Add boundary marker.</p>
<ul>
  <li>
    <h4>Electrostatic field</h4>
    <p>addBoundary(name, type = {"potential", "surface_charge_density"}, value)</p>
  </li>
  <li>
    <h4>Electric current field</h4>
    <p>addBoundary(name, type = {"potential", "inward_current_flow"}, value)</p>
  </li>
  <li>
    <h4>Magnetostatic field</h4>
    <p>addBoundary(name, type = {"vector_potential", "surface_current_density"}, value)</p>
  </li>
  <li>
    <h4>Heat transfer</h4>
    <p>addBoundary(name, type = "temperature", temperature)</p>
    <p>addBoundary(name, type = "heat_flux", heat_flux, h, external_temperature)</p>
  </li>
</ul>

<h3>addMaterial(name, type, value, ...)</h3>
<p>Add label marker.</p>
<ul>
  <li>
    <h4>Electrostatic field</h4>
    <p>addMaterial(name, charge_density, permittivity)</p>
  </li>
  <li>
    <h4>Electric current field</h4>
    <p>addBoundary(name, conductivity)</p>
  </li>
  <li>
    <h4>Magnetostatic field</h4>
    <p>addBoundary(name, current_density, double permeability)</p>
  </li>
  <li>
    <h4>Heat transfer</h4>
    <p>addBoundary(name, volume_heat, thermal_conductivity)</p>
  </li>
</ul>

<h3>solve()</h3>
<p>Solve problem.</p>

<h3>zoomBestFit()</h3>
<p>Zoom best fit.</p>

<h3>mode(mode = {"node", "edge", "label", "postprocessor"})</h3>
<p>Set mode.</p>

<h3>selectNone()</h3>
<p>Unselect objects.</p>

<h3>selectAll()</h3>
<p>Select all objects.</p>

<h3>selectNode(index, ...)</h3>
<p>Select nodes with given index.</p>

<h3>selectEdge(index, ...)</h3>
<p>Select edges with given index.</p>

<h3>selectLabel(index, ...)</h3>
<p>Select labels with given index.</p>

<h3>moveSelection(dx, dy, copy = false)</h3>
<p>Move selected objects.</p>

<h3>rotateSelection(x, y, angle, copy = false)</h3>
<p>Rotate selected objects.</p>

<h3>scaleSelection(x, y, scale, copy = false)</h3>
<p>Scale selected objects.</p>

<h3>result = pointResult(x, y)</h3>
<p>Local variables at point [x, y].</p>
<ul>
  <li>
    <h4>Electrostatic field</h4>
    <p>Properties: Potential, Ex, Ey, E, Dx, Dy, Energy, Permittivity.</p>
  </li>
  <li>
    <h4>Electric current field</h4>
    <p>Properties: Potential, Jx, Jy, J, Ex, Ey, E, Losses, Conductivity.</p>
  </li>
  <li>
    <h4>Magnetostatic field</h4>
    <p>Properties: Potential, Bx, By, B, Hx, Hy, H, Energy, Permeability.</p>
  </li>
  <li>
    <h4>Heat transfer</h4>
    <p>Properties: Temperature, Gx, Gy, G, Fx, Fy, F, Conductivity.</p>
  </li>
</ul>

<h4>Example:</h4>
<pre class="code">
// local point result
result = pointResult(0.03, 0.03);
print("Potential = " + result.Potential);
</pre>

<h3>integral = volumeIntegral(index, ...)</h3>
<p>Volume integral in areas with given index.</p>
<ul>
  <li>
    <h4>Electrostatic field</h4>
    <p>Properties: Volume, CrossSection, Ex_avg, Ey_avg, E_avg, Dx_avg, Dy_avg, D_avg, Energy.</p>
  </li>
  <li>
    <h4>Electric current field</h4>
    <p>Properties: Volume, CrossSection, Jx_avg, Jy_avg, J_avg, Ex_avg, Ey_avg, E_avg, Losses.</p>
  </li>
  <li>
    <h4>Magnetostatic field</h4>
    <p>Properties: Volume, CrossSection, Bx_avg, By_avg, B_avg, Hx_avg, Hy_avg, H_avg, Energy.</p>
  </li>
  <li>
    <h4>Heat transfer</h4>
    <p>Properties: Volume, CrossSection, Temperature, Gx_avg, Gy_avg, G_avg, Fx_avg, Fy_avg, F_avg.</p>
  </li>
</ul>

<h4>Example:</h4>
<pre class="code">
// volume integral
integral = volumeIntegral(0, 1);
print("Volume = " + integral.Volume);
</pre>

<h2>Examples</h2>

<h3>Capacitor</h3>
<pre class="code">
/// model
newDocument("Electrostatic 2D", "axisymmetric", "electrostatic", 1, 2, 0, 0)

// boundaries
addBoundary("U = 1 V", "potential", 1)
addBoundary("U = 0 V", "potential", 0)
addBoundary("neumann", "surface_charge_density", 0)

// materials
addMaterial("air", 0, 1)
addMaterial("diel 1", 0, 10)
addMaterial("diel 2", 0, 3)

// edges
addEdge(0, 0.2, 0, 0.08, 0, "neumann")
addEdge(0.01, 0.08, 0.01, 0, 0, "U = 1 V")
addEdge(0.01, 0, 0.03, 0, 0, "neumann")
addEdge(0.03, 0, 0.03, 0.08, 0, "none")
addEdge(0.03, 0.08, 0.05, 0.08, 0, "none")
addEdge(0.05, 0, 0.03, 0, 0, "neumann")
addEdge(0.05, 0.08, 0.05, 0, 0, "U = 0 V")
addEdge(0.06, 0, 0.06, 0.08, 0, "U = 0 V")
addEdge(0.05, 0.08, 0.06, 0.08, 0, "U = 0 V")
addEdge(0.06, 0, 0.2, 0, 0, "neumann")
addEdge(0.2, 0, 0, 0.2, 90, "neumann")
addEdge(0.01, 0.08, 0.03, 0.08, 0, "none")
addEdge(0.01, 0.08, 0, 0.08, 0, "U = 1 V")

// labels
addLabel(0.019, 0.021, 0, "diel 1")
addLabel(0.0379, 0.051, 0, "diel 2")
addLabel(0.0284191, 0.123601, 0, "air")

// capacitance
print("Capacitance:");
var dx = 0.01;
var i = 0;
do
{
  // move edges
  if (i > 0)
  {
    selectNone();	
    selectEdge(6, 7, 8);
    moveSelection(dx, 0);	
  }

  solve();
  integral = volumeIntegral();
  print((2*2*integral.Energy)/(1^2));

  i++;
} while (i<5);
</pre>
</body>
</html>
