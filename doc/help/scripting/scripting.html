<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="../style.css" media="screen" title="Default">
  <title>Scripting</title>
</head>
<body>
<h1>Scripting</h1>
<p>QtScript is based on the ECMAScript scripting language.</p>

<h2>Reference documentation</h2>

<h3>include(filename)</h3>
<p>Include and run script with filename.</p>

<h3>printToFile(filename, string, mode = {"write", "append"})</h3>
<p>Print string to file.</p>

<pre class="code">
printToFile("/tmp/print.txt", "hello", "append");
</pre>

<h3>newDocument(name, type, physicfield, numberofrefinements, polynomialorder, frequency, adaptivitytype, adaptivitysteps, adaptivitytolerance)</h3>
<p>Create new document.</p>
<ul>
  <li>
    <p>type = {"planar", "axisymmetric"}</p>
  </li>
  <li>
    <p>numberofrefinements >= 0</p>
  </li>
  <li>
    <p>polynomialorder = 1 to 10</p>
  </li>
  <li>
    <p>physicfield = {"electrostatic", "magnetostatic", "current field", "heat transfer", "harmonic magnetic"}</p>
  </li>
  <li>
    <p>adaptivitytype = {"disabled", "h-adaptivity", "hp-adaptivity"}</p>
  </li>
  <li>
    <p>frequency >= 0 (only for harmonic magnetic field)</p>
  </li>
  <li>
    <p>adaptivitysteps > 0</p>
  </li>
  <li>
    <p>adaptivitytolerance > 0</p>
  </li>
</ul>

<pre class="code">
newDocument("Electrostatic", "axisymmetric", "electrostatic", 0, 2, 0, "hp-adaptivity", 10, 0.5);
</pre>

<h3>openDocument(filename)</h3>
<p>Open document.</p>

<h3>saveDocument(filename)</h3>
<p>Save document.</p>

<h3>addNode(x, y)</h3>

<h3>addLabel(x, y, area, marker)</h3>

<h3>addEdge(x1, y1, x2, y2, angle, marker)</h3>

<h3>addBoundary(name, type, value, ...)</h3>
<p>Add boundary marker.</p>
<ul>
  <li>
    <h4>Electrostatic field</h4>
    <p>addBoundary(name, type = {"potential", "surface_charge_density"}, value)</p>
  </li>
  <li>
    <h4>Electric current field</h4>
    <p>addBoundary(name, type = {"potential", "inward_current_flow"}, value)</p>
  </li>
  <li>
    <h4>Magnetostatic field</h4>
    <p>addBoundary(name, type = {"vector_potential", "surface_current_density"}, value)</p>
  </li>
  <li>
    <h4>Harmonic magnetic field</h4>
    <p>addBoundary(name, type = {"vector_potential", "surface_current_density"}, value)</p>
  </li>
  <li>
    <h4>Heat transfer</h4>
    <p>addBoundary(name, type = "temperature", temperature)</p>
    <p>addBoundary(name, type = "heat_flux", heat_flux, h, external_temperature)</p>
  </li>
</ul>

<h3>addMaterial(name, type, value, ...)</h3>
<p>Add label marker.</p>
<ul>
  <li>
    <h4>Electrostatic field</h4>
    <p>addMaterial(name, charge_density, permittivity)</p>
  </li>
  <li>
    <h4>Electric current field</h4>
    <p>addMaterial(name, conductivity)</p>
  </li>
  <li>
    <h4>Magnetostatic field</h4>
    <p>addMaterial(name, current_density, double permeability)</p>
  </li>
  <li>
    <h4>Harmonic magnetic field</h4>
    <p>addMaterial(name, current_density_real, current_density_imag, double permeability, conductivity)</p>
  </li>
  <li>
    <h4>Heat transfer</h4>
    <p>addMaterial(name, volume_heat, thermal_conductivity)</p>
  </li>
</ul>

<h3>solve()</h3>
<p>Solve problem.</p>

<h3>zoomBestFit()</h3>
<p>Zoom best fit.</p>

<h3>mode(mode = {"node", "edge", "label", "postprocessor"})</h3>
<p>Set mode.</p>

<h3>selectNone()</h3>
<p>Unselect objects.</p>

<h3>selectAll()</h3>
<p>Select all objects.</p>

<h3>selectNode(index, ...)</h3>
<p>Select nodes with given index.</p>

<h3>selectEdge(index, ...)</h3>
<p>Select edges with given index.</p>

<h3>selectLabel(index, ...)</h3>
<p>Select labels with given index.</p>

<h3>moveSelection(dx, dy, copy = false)</h3>
<p>Move selected objects.</p>

<h3>rotateSelection(x, y, angle, copy = false)</h3>
<p>Rotate selected objects.</p>

<h3>scaleSelection(x, y, scale, copy = false)</h3>
<p>Scale selected objects.</p>

<h3>result = pointResult(x, y)</h3>
<p>Local variables at point [x, y].</p>
<ul>
  <li>
    <h4>Electrostatic field</h4>
    <p>Properties: X, Y, V, Ex, Ey, E, Dx, Dy, wj, epsr.</p>
  </li>
  <li>
    <h4>Magnetostatic field</h4>
    <p>Properties: X, Y, A, Bx, By, B, Hx, Hy, H, wm, mur.</p>
  </li>
  <li>
    <h4>Electric current field</h4>
    <p>Properties: X, Y, V, Jx, Jy, J, Ex, Ey, E, pj, gamma.</p>
  </li>
  <li>
    <h4>Harmonic magnetic field</h4>
    <p>Properties: X, Y, A_real, A_imag, A, B, Bx_real, By_real, B_real, Bx_imag, By_imag, B_imag, 
                   H, Hx_real, Hy_real, H_real, Hx_imag, Hy_imag, H_imag, Ji_real, Ji_imag, Ji_real
                   J_real, J_imag, J_real, pj, wm, mur</p>
  </li>
  <li>
    <h4>Heat transfer</h4>
    <p>Properties: X, Y, T, Gx, Gy, G, Fx, Fy, F, lambda.</p>
  </li>
</ul>

<pre class="code">
// local point result
result = pointResult(0.03, 0.03);
print("Potential = " + result.V);
</pre>

<h3>integral = volumeIntegral(index, ...)</h3>
<p>Volume integral in areas with given index.</p>
<ul>
  <li>
    <h4>Electrostatic field</h4>
    <p>Properties: V, S, Ex_avg, Ey_avg, E_avg, Dx_avg, Dy_avg, D_avg, We.</p>
  </li>
  <li>
    <h4>Magnetostatic field</h4>
    <p>Properties: V, S, Bx_avg, By_avg, B_avg, Hx_avg, Hy_avg, H_avg, Wm.</p>
  </li>
  <li>
    <h4>Electric current field</h4>
    <p>Properties: V, S, Jx_avg, Jy_avg, J_avg, Ex_avg, Ey_avg, E_avg, Pj.</p>
  </li>
  <li>
    <h4>Harmonic magnetic field</h4>
    <p>Properties: V, S, Ii_real, Ii_imag, It_real, It_imag, Pj, Fx_real, Fx_imag, Fy_real, Fy_imag, Wm.</p>
  </li>
  <li>
    <h4>Heat transfer</h4>
    <p>Properties: V, S, T, Gx_avg, Gy_avg, G_avg, Fx_avg, Fy_avg, F_avg.</p>
  </li>
</ul>

<pre class="code">
// volume integral
integral = volumeIntegral(0, 1);
print("Volume = " + integral.V);
</pre>

<h3>integral = surfaceIntegral(index, ...)</h3>
<p>Surface integral in edges with given index.</p>
<ul>
  <li>
    <h4>Electrostatic field</h4>
    <p>Properties: l, S, Q.</p>
  </li>
  <li>
    <h4>Electric current field</h4>
    <p>Properties: l, S, I.</p>
  </li>
  <li>
    <h4>Magnetostatic field</h4>
    <p>Properties: l, S.</p>
  </li>
  <li>
    <h4>Harmonic magnetic field</h4>
    <p>Properties: l, S.</p>
  </li>
  <li>
    <h4>Heat transfer</h4>
    <p>Properties: l, S, T_avg, T_diff, F.</p>
  </li>
</ul>

<pre class="code">
// surface integral
integral = surfaceIntegral(1, 3);
print("Charge = " + integral.Q);
</pre>

<h2>Examples</h2>

<h3>Capacitor</h3>
<pre class="code">
// Problem properties
newDocument("Axisymmetric electrostatic capacitor", "axisymmetric", "electrostatic", 1, 2, 0, "disabled", 0, 0);

// Variables
r1 = 0.01;
r2 = 0.03;
r3 = 0.05;
r4 = 0.06;
l =  0.16;
eps1 = 10;
eps2 = 3;
U = 10;
dr = 0.01;

// Boundary conditions
addBoundary("Source electrode", "potential", U);
addBoundary("Ground electrode", "potential", 0);
addBoundary("Neumann BC", "surface_charge_density", 0);

// Materials
addMaterial("Air", 0, 1);
addMaterial("Dielectric n.1", 0, eps1);
addMaterial("Dielectric n.2", 0, eps2);

// Edges
addEdge(0, 3/2*l, 0, l/2, 0, "Neumann BC");
addEdge(r1, l/2, r1, 0, 0, "Source electrode");
addEdge(r1, 0, r2, 0, 0, "Neumann BC");
addEdge(r2, 0, r2, l/2, 0, "none");
addEdge(r2, l/2, r3, l/2, 0, "none");
addEdge(r3, 0, r2, 0, 0, "Neumann BC");
addEdge(r3, l/2, r3, 0, 0, "Ground electrode");
addEdge(r4, 0, r4, l/2, 0, "Ground electrode");
addEdge(r3, l/2, r4, l/2, 0, "Ground electrode");
addEdge(r4, 0, 3/2*l, 0, 0, "Neumann BC");
addEdge(3/2*l, 0, 0, 3/2*l, 90, "Neumann BC");
addEdge(r1, l/2, r2, l/2, 0, "none");
addEdge(r1, l/2, 0, l/2, 0, "Source electrode");

// Labels
addLabel(0.019, 0.021, 0, "Dielectric n.1");
addLabel(0.0379, 0.051, 0, "Dielectric n.2");
addLabel(0.0284191, 0.123601, 0, "Air");

// Calculation of capacity
zoomBestFit();
selectNone();
print("C = f(r) (F):");
i = 0;
do
{
	if (i > 0)
	{                       
		selectEdge(6, 7, 8);
		moveSelection(dr, 0);   
	}
	solve();
	integral = volumeIntegral();

	print((2*2*integral.We)/(U^2));
	i++;
} while (i<5);
</pre>
</body>
</html>
